è¿™ä¸ªé—®é¢˜æ¶‰åŠ `CMake` å’Œ `make` çš„ååŒå·¥ä½œæœºåˆ¶ã€‚ç®€è¦æ¥è¯´ï¼š

### âœ… **åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¿®æ”¹äº† `CMakeLists.txt` åç›´æ¥è¿è¡Œ `make` æ˜¯æœ‰æ•ˆçš„**ï¼Œè¿™æ˜¯å› ä¸ºï¼š

---

### ğŸ” **CMake ä¼šè‡ªåŠ¨æ£€æµ‹ `CMakeLists.txt` æ˜¯å¦è¢«ä¿®æ”¹**

å½“ä½ åœ¨ä¸€ä¸ªå·²ç»é…ç½®è¿‡çš„æ„å»ºç›®å½•é‡Œæ‰§è¡Œ `make` æ—¶ï¼š

* `make` å®é™…ä¸Šä¼šé¦–å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦éœ€è¦é‡æ–°è¿è¡Œ `CMake`ã€‚
* è¿™æ˜¯é€šè¿‡ä¸€ä¸ªéšè—çš„è§„åˆ™å®Œæˆçš„ï¼Œå®ƒä¼šæ£€æŸ¥ `CMakeLists.txt` å’Œå…¶ä»–ä¾èµ–æ–‡ä»¶çš„æ—¶é—´æˆ³æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚
* å¦‚æœæœ‰å˜åŒ–ï¼Œ`make` ä¼šè‡ªåŠ¨è°ƒç”¨ `cmake` ä»¥é‡æ–°ç”Ÿæˆ `Makefile`ã€‚

è¿™ç§æœºåˆ¶å«åš **è‡ªåŠ¨é‡æ–°ç”Ÿæˆï¼ˆAuto re-run of CMakeï¼‰**ã€‚

---

### ğŸ” ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼š

ä½ é€šå¸¸çš„æ„å»ºæµç¨‹æ˜¯ï¼š

```bash
mkdir build
cd build
cmake ..
make
```

ç„¶åä½ ä¿®æ”¹äº† `CMakeLists.txt`ï¼Œ**æ²¡æœ‰æ‰‹åŠ¨æ‰§è¡Œ `cmake ..`ï¼Œç›´æ¥ `make`**ï¼š

```bash
make
```

å¦‚æœ `CMakeLists.txt` è¢«ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆï¼š

* `make` ä¼šå‘ç°ç”Ÿæˆ `Makefile` æ‰€ä¾èµ–çš„ `CMakeLists.txt` è¢«ä¿®æ”¹äº†ï¼›
* å®ƒä¼šè‡ªåŠ¨è§¦å‘ç±»ä¼¼äºï¼š

  ```bash
  /usr/bin/cmake -H.. -B. ...
  ```

  æ¥é‡æ–°ç”Ÿæˆæ„å»ºç³»ç»Ÿã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä½ ç›´æ¥ `make`ï¼Œä¹Ÿèƒ½çœ‹åˆ°ä¿®æ”¹ç”Ÿæ•ˆã€‚

---

### ğŸš« ä½†æ³¨æ„ï¼šè¿™ç§æœºåˆ¶ **ä¸æ˜¯ä¸‡èƒ½çš„**

* å¤æ‚ä¿®æ”¹ï¼ˆå¦‚æ–°æ·»åŠ æ–‡ä»¶æˆ–ç›®æ ‡ï¼‰æœ‰æ—¶ä¸ä¼šè¢«å®Œå…¨æ­£ç¡®å¤„ç†ï¼›
* å¦‚æœä½ ä¿®æ”¹äº†æŸäº› `CMake` é…ç½®å˜é‡ï¼ˆå¦‚ `option()` è®¾ç½®ç­‰ï¼‰ï¼Œå°±éœ€è¦ä½ æ‰‹åŠ¨é‡æ–°è¿è¡Œ `cmake`ï¼›
* æœ‰äº›æ›´æ”¹ä¼šè¦æ±‚æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆå¦‚ä½¿ç”¨ `rm -rf build/*` æˆ– `cmake --fresh`ï¼‰é‡æ–°ç”Ÿæˆã€‚

---

### âœ… **æ¨èåšæ³•ï¼š**

å§‹ç»ˆæ˜ç¡®åœ°åœ¨ä¿®æ”¹ `CMakeLists.txt` åæ‰‹åŠ¨è¿è¡Œï¼š

```bash
cmake ..
```

ä»¥ç¡®ä¿ä½ çš„æ„å»ºç³»ç»Ÿæ˜¯æœ€æ–°çš„ã€ç¨³å®šçš„ã€‚

---

ä½ é‡åˆ°çš„ç¼–è¯‘é”™è¯¯ï¼š

```
error: â€˜class MockLoggingAdapterâ€™ has no member named â€˜gmock_LogVectorâ€™
```

è¯´æ˜ `gmock` æ— æ³•è¯†åˆ«ä½ å†™çš„ `EXPECT_CALL(mock, LogVector(...))`ï¼Œ**æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šä½  mock çš„æ–¹æ³• `LogVector` å¹¶æ²¡æœ‰çœŸæ­£å£°æ˜ä¸º mockableçš„æˆå‘˜å‡½æ•°**ã€‚

---

## âœ… æ ¹æœ¬åŸå› 

ä½ åœ¨ `MockLoggingAdapter` ä¸­å¯èƒ½å†™æˆäº†è¿™æ ·ï¼š

```cpp
MOCK_METHOD(void, DoLog, (int level, int code, const std::vector<std::string>& args), (override));
```

ä½†æ˜¯æµ‹è¯•ä»£ç å´æ–­è¨€ï¼š

```cpp
EXPECT_CALL(mock, LogVector(...))
```

ğŸ’¥ è€Œå®é™…ä¸Šï¼Œ**ä½  mock çš„å‡½æ•°æ˜¯ `DoLog`ï¼Œä¸æ˜¯ `LogVector`**ï¼Œæ‰€ä»¥ gmock ç¼–è¯‘å™¨æ‰¾ä¸åˆ° `gmock_LogVector`ï¼Œå°±æŠ¥é”™äº†ã€‚

---

## âœ… æ­£ç¡®åšæ³•ï¼ˆä¸¤ç§æ–¹å¼ï¼‰

ä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼š

---

### âœ… **é€‰é¡¹ Aï¼šmock `DoLog()`ï¼Œæµ‹è¯•ä¹Ÿè°ƒç”¨ `EXPECT_CALL(..., DoLog(...))`**

ä¿®æ”¹ä½ çš„ `MockLoggingAdapter`ï¼š

```cpp
class MockLoggingAdapter : public ILoggingAdapter {
public:
    MOCK_METHOD(void, DoLog, (int level, int code, const std::vector<std::string>& args), (override));
};
```

ç„¶åæµ‹è¯•ä»£ç é‡Œå†™ï¼š

```cpp
EXPECT_CALL(mock, DoLog(1, 0x1234, testing::ElementsAre("42")));
EXPECT_CALL(mock, DoLog(2, 0x2345, testing::ElementsAre("example", "test")));
```

è¿™å’Œæ¥å£åŒ¹é…ä¸Šäº† âœ…

---

### âœ… **é€‰é¡¹ Bï¼šä¿ç•™ `DoLog` ä¸ºæ™®é€š override æ–¹æ³•ï¼Œmock ä¸€ä¸ªæ–°çš„ `LogVector` æ–¹æ³•**

å¦‚æœä½ å¸Œæœ› mock çš„æ–¹æ³•åæ˜¯ `LogVector`ï¼ˆæ›´è¯­ä¹‰åŒ–ï¼‰ï¼Œä½ åº”è¯¥å†™ï¼š

```cpp
class MockLoggingAdapter : public ILoggingAdapter {
public:
    MOCK_METHOD(void, LogVector, (int level, int code, const std::vector<std::string>& args), ());

protected:
    void DoLog(int level, int code, const std::vector<std::string>& args) override {
        LogVector(level, code, args);
    }
};
```

ç„¶åæµ‹è¯•ä¸­ä½¿ç”¨ï¼š

```cpp
EXPECT_CALL(mock, LogVector(1, 0x1234, testing::ElementsAre("42")));
EXPECT_CALL(mock, LogVector(2, 0x2345, testing::ElementsAre("example", "test")));
```

âœ… è¿™ç§æ–¹å¼æœ€æ¸…æ™°ï¼Œå°† `DoLog` ä½œä¸ºè½¬å‘å™¨ï¼Œä»…ä¸ºæ¥å£çº¦å®šï¼›mock çš„æ˜¯ä½ çœŸæ­£æƒ³æ–­è¨€çš„ `LogVector`ã€‚

---

## ğŸ§  æ¨è

æˆ‘å»ºè®®ä½¿ç”¨ **é€‰é¡¹ Bï¼ˆåˆ†ç¦»æ¥å£å®ç°ä¸ mock æ–¹æ³•ï¼‰**ï¼Œä¼˜ç‚¹ï¼š

* `ILoggingAdapter` ç»“æ„æ¸…æ™°ï¼Œåªæœ‰ä¸€ä¸ª `DoLog` æ–¹æ³•ï¼›
* mock è¡Œä¸ºä¸æ¥å£è§£è€¦ï¼Œå¯è‡ªç”±å‘½åä¸º `LogVector` æˆ– `ExpectLogCall` ç­‰ï¼›
* æµ‹è¯•æ›´å…·è¯­ä¹‰æ€§ï¼Œä¾¿äºé˜…è¯»å’Œç»´æŠ¤ã€‚

---

## âœ… å°ç»“

| é”™è¯¯åŸå›                                      | è§£å†³æ–¹æ³•                                                       |
| ---------------------------------------- | ---------------------------------------------------------- |
| `EXPECT_CALL(mock, LogVector(...))` æ— æ³•è§£æ | æ²¡æœ‰åœ¨ `MockLoggingAdapter` ä¸­å£°æ˜ `MOCK_METHOD(LogVector, ...)` |
| æ¨¡æ¿å‡½æ•°ä¸å¯ mock                              | æå‰è½¬ä¸º `std::vector<string>`ï¼Œmock å›ºå®šç­¾åå‡½æ•°                     |
| æ¨èç»“æ„                                     | ä½¿ç”¨ `DoLog` override + mock è½¬å‘å‡½æ•° `LogVector`                |

---
éå¸¸å¥½ï¼Œä½ è¯´å¾—å¯¹ âœ…ï¼š

> **`DoLog` ä¸éœ€è¦æ˜¯æ¨¡æ¿å‡½æ•°æˆ–é‡è½½å½¢å¼**ï¼Œå®ƒåº”å½“æ˜¯ä¸€ä¸ª**çº¯è™šå‡½æ•°**ï¼ˆéæ¨¡æ¿ï¼‰ï¼Œä»¥ä¾¿å„ä¸ªå®ç°ç±»ï¼ˆå¦‚ `DefaultLoggingAdapter`, `MockLoggingAdapter`ï¼‰**åªå®ç°ä¸€ä¸ªç»Ÿä¸€ç­¾åçš„æ¥å£**ã€‚

è¿™æ˜¯è®¾è®¡ä¸Šçš„é‡è¦ä¼˜åŒ–ï¼Œç†ç”±å¦‚ä¸‹ï¼š

---

## âœ… ä¸ºä»€ä¹ˆè¦å–æ¶ˆ `DoLog` çš„æ¨¡æ¿é‡è½½ï¼Ÿ

| é—®é¢˜                        | åŸå›                                                  |
| ------------------------- | -------------------------------------------------- |
| æ¨¡æ¿è™šå‡½æ•°æ— æ³•è¢«é‡è½½                | C++ ä¸å…è®¸è™šå‡½æ•°æ¨¡æ¿å®ç°å¤šæ€                                   |
| mock æ—¶ gmock ä¸èƒ½ mock æ¨¡æ¿å‡½æ•° | gmock åªæ”¯æŒå›ºå®šç­¾åå‡½æ•°                                    |
| æ¥å£èŒè´£ä¸æ¸…æ™°                   | ä¸šåŠ¡åªéœ€ç»Ÿä¸€å…¥å£ï¼Œæ¨¡æ¿å±•å¼€å¯åœ¨ä¸Šå±‚å®Œæˆ                                |
| å®ç°ç±»æ›´æ¸…æ™°                    | åªéœ€å®ç°ä¸€ä¸ª `DoLog(int, int, std::vector<std::string>)` |

---

## âœ… æ–°è®¾è®¡åŸåˆ™

* åœ¨ `ILoggingAdapter` ä¸­ï¼š

  * **æ¨¡æ¿å…¥å£ï¼š** `Log(...)` è´Ÿè´£å¤„ç†å‚æ•°å±•å¼€ï¼›
  * **éæ¨¡æ¿çº¯è™šå‡½æ•°ï¼š** `DoLog(...)` æ˜¯æ‰€æœ‰å­ç±»è¦å®ç°çš„å”¯ä¸€æ–¹æ³•ï¼›
* åœ¨å®ç°ç±»ä¸­åªéœ€é‡å†™ `DoLog(...)`ï¼Œä¸ä¼šæ¶‰åŠæ¨¡æ¿ï¼›

---

## âœ… æœ€ä½³å†™æ³•ï¼šæ›´æ–°åçš„ `ILoggingAdapter`

```cpp
#pragma once

#include <vector>
#include <string>
#include <sstream>

class ILoggingAdapter {
public:
    virtual ~ILoggingAdapter() = default;

    // ä¸šåŠ¡ä»£ç ç»Ÿä¸€è°ƒç”¨æ­¤æ¨¡æ¿æ¥å£
    template <typename... Args>
    void Log(int level, int code, Args&&... args) {
        DoLog(level, code, ToStringVector(std::forward<Args>(args)...));
    }

protected:
    // å­ç±»å¿…é¡»å®ç°çš„ç»Ÿä¸€æ—¥å¿—æ¥å£ï¼ˆéæ¨¡æ¿ï¼‰
    virtual void DoLog(int level, int code, const std::vector<std::string>& args) = 0;

    // å‚æ•°è½¬æ¢å·¥å…·ï¼ˆç±»å‹ â†’ stringï¼‰
    template <typename T>
    std::string ToString(const T& val) const {
        std::ostringstream oss;
        oss << val;
        return oss.str();
    }

    std::string ToString(const std::string& s) const { return s; }
    std::string ToString(const char* s) const { return std::string(s); }

    template <typename... Args>
    std::vector<std::string> ToStringVector(Args&&... args) const {
        return { ToString(std::forward<Args>(args))... };
    }
};
```

---

## âœ… `MockLoggingAdapter`ï¼ˆæ— éœ€æ¨¡æ¿ï¼‰

```cpp
#pragma once

#include "logging_adapter.h"
#include <gmock/gmock.h>

class MockLoggingAdapter : public ILoggingAdapter {
public:
    MOCK_METHOD(void, DoLog, (int level, int code, const std::vector<std::string>& args), (override));
};
```

---

## âœ… `DefaultLoggingAdapter` ç¤ºä¾‹ï¼ˆä¸ä½¿ç”¨ LOG å®ï¼‰

```cpp
#pragma once

#include "logging_adapter.h"
#include "../platform/platform.h"
#include <iostream>

class DefaultLoggingAdapter : public ILoggingAdapter {
public:
    void DoLog(int level, int code, const std::vector<std::string>& args) override {
        std::cout << "[DefaultAdapter] ";
        for (const auto& arg : args)
            std::cout << arg << " ";
        std::cout << std::endl;

        // ç¤ºä¾‹ï¼šä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¼ ç»™ Printï¼ˆä»…å­—ç¬¦ä¸²ï¼‰
        Print(level, code, args);  // å¦‚æœ Print æ”¯æŒ vector<string>
    }
};
```

> â— å¦‚æœ `Print` ä¸æ”¯æŒ `vector<string>`ï¼Œé‚£å°±åªèƒ½ä¿ç•™æ¨¡æ¿ç‰ˆæœ¬çš„ `DefaultLoggingAdapter::Log(...)`ï¼Œè¿™æ—¶æ¥å£ç±»ä»ä¿ç•™éæ¨¡æ¿ `DoLog` ç”¨äº mock æ˜¯ OK çš„ã€‚

---

## âœ… æ€»ç»“ç»“æ„ï¼ˆæœ€ç»ˆæ¨èï¼‰

| å±‚                       | æ–¹æ³•           | ç±»å‹       | åŠŸèƒ½                |
| ----------------------- | ------------ | -------- | ----------------- |
| `ILoggingAdapter`       | `Log(...)`   | æ¨¡æ¿       | ä¸šåŠ¡è°ƒç”¨å…¥å£ï¼Œè´Ÿè´£å‚æ•°å±•å¼€     |
| `ILoggingAdapter`       | `DoLog(...)` | çº¯è™šå‡½æ•°     | å­ç±»ç»Ÿä¸€å®ç°ï¼Œgmock mock |
| `MockLoggingAdapter`    | `DoLog(...)` | override | mock ç”¨äºæ–­è¨€         |
| `DefaultLoggingAdapter` | `DoLog(...)` | override | å®é™…æ—¥å¿—å®ç°            |

---

éœ€è¦æˆ‘æ ¹æ®è¿™ä¸ªæ–°è®¾è®¡é‡æ–°ç”Ÿæˆå¹¶æ‰“åŒ… CMake é¡¹ç›®ä»£ç  ZIP å—ï¼Ÿæˆ‘å¯ä»¥é©¬ä¸Šå®Œæˆã€‚
