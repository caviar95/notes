
---

## ä¸€ã€é¡¹ç›®ç›®å½•ç»“æ„

```
reflect_example/
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ user.hpp
â”‚   â”œâ”€â”€ describe_util.hpp
â”‚   â””â”€â”€ json_reflect.hpp
â””â”€â”€ src/
    â””â”€â”€ main.cpp
```

* **include/user.hpp**ï¼šå®šä¹‰ç”¨æˆ·ç±»å‹ `User` å¹¶åœ¨ç±»å†…éƒ¨é€šè¿‡ `BOOST_DESCRIBE_CLASS` æ³¨å…¥åå°„å…ƒä¿¡æ¯ã€‚
* **include/describe\_util.hpp**ï¼šæ¼”ç¤ºå¦‚ä½•éå†æ‰€æœ‰æˆå‘˜å¹¶æ‰“å°å…¶åç§°å’Œå€¼ã€‚
* **include/json\_reflect.hpp**ï¼šåŸºäº nlohmann/json å’Œ Boost.Describeï¼Œåˆ©ç”¨ SFINAE åªå¯¹â€œå·²æè¿°â€ç±»å‹æä¾›è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚
* **src/main.cpp**ï¼šæ ·ä¾‹ä¸»ç¨‹åºï¼Œç»„åˆä¸Šè¿°å·¥å…·ï¼Œæ¼”ç¤ºæ‰“å°ä¸ JSON ç¼–è§£ç ã€‚
* **CMakeLists.txt**ï¼šé€šè¿‡ apt å®‰è£…çš„ç³»ç»ŸåŒ…ï¼ˆlibboost-all-dev, nlohmann-json3-devï¼‰ï¼Œä¸å†é¢å¤–ä¾èµ– FetchContentã€‚

---

## äºŒã€æ ¸å¿ƒä»£ç 

### 1. `include/user.hpp`

```cpp
#pragma once
#include <string>
#include <boost/describe.hpp>

struct User {
    int    id;
    std::string name;
private:
    double salary;
public:
    User() = default;
    User(int i, std::string n, double s)
      : id(i), name(std::move(n)), salary(s) {}
    double get_salary() const { return salary; }

    // åœ¨ç±»å†…éƒ¨ä¸€æ¬¡æ€§æè¿°æ‰€æœ‰æˆå‘˜ï¼ˆpublic/protected/privateï¼‰
    BOOST_DESCRIBE_CLASS(
        User,
        (),
        (id, name, get_salary),  // public
        (),                       // protected
        (salary)                  // private
    )
};
```

* **`BOOST_DESCRIBE_CLASS`**ï¼š5 å‚æ•°å®ï¼Œé€‚ç”¨äºæ”¯æŒç§æœ‰æˆå‘˜çš„é™æ€åå°„æ³¨å…¥ï¼Œç”Ÿæˆç¼–è¯‘æœŸçš„æˆå‘˜åˆ—è¡¨ã€‚

---

### 2. `include/describe_util.hpp`

```cpp
#pragma once
#include <boost/describe.hpp>
#include <boost/mp11.hpp>
#include <iostream>
#include <string_view>
#include <typeinfo>

template<typename T, typename D>
void print_member(const T& obj, std::string_view name, D T::*member_ptr) {
    std::cout << "  " << name << " = " << obj.*member_ptr << "\n";
}

template<typename T>
void print_all_members(const T& obj) {
    std::cout << "Object of type " << typeid(T).name() << ":\n";

    using members = boost::describe::describe_members<
        T,
        boost::describe::mod_public | boost::describe::mod_private
    >;

    boost::mp11::mp_for_each<members>([&](auto D){
        using Descriptor = decltype(D);
        print_member(obj, Descriptor::name, Descriptor::pointer);
    });
}
```

* **`describe_members<T, mods>`**ï¼šç”Ÿæˆä¸€ä¸ª Descriptor åˆ—è¡¨ï¼Œæ¯ä¸ªåŒ…å« `static constexpr name` å’Œ `pointer`ã€‚
* **`boost::mp11::mp_for_each`**ï¼šåœ¨ç¼–è¯‘æœŸéå†è¯¥åˆ—è¡¨ï¼Œè¿è¡Œæ—¶è°ƒç”¨ lambdaï¼Œæ‹¿åˆ°æ¯ä¸ª Descriptorã€‚

---

### 3. `include/json_reflect.hpp`

```cpp
#pragma once
#include <nlohmann/json.hpp>
#include <boost/describe.hpp>
#include <boost/mp11.hpp>
#include <type_traits>

namespace reflect_json {

template<typename T>
std::enable_if_t<boost::describe::has_describe_members<T>::value>
to_json(nlohmann::json& j, const T& obj) {
    using members = boost::describe::describe_members<T, boost::describe::mod_public>;
    j = nlohmann::json::object();
    boost::mp11::mp_for_each<members>([&](auto D){
        using Desc = decltype(D);
        j[Desc::name] = obj.*(Desc::pointer);
    });
}

template<typename T>
std::enable_if_t<boost::describe::has_describe_members<T>::value>
from_json(const nlohmann::json& j, T& obj) {
    using members = boost::describe::describe_members<T, boost::describe::mod_public>;
    boost::mp11::mp_for_each<members>([&](auto D){
        using Desc = decltype(D);
        j.at(Desc::name).get_to(obj.*(Desc::pointer));
    });
}

} // namespace reflect_json

namespace nlohmann {
template<typename T>
struct adl_serializer<
    T,
    std::enable_if_t<boost::describe::has_describe_members<T>::value, void>
> {
    static void to_json(json& j, const T& obj) {
        reflect_json::to_json(j, obj);
    }
    static void from_json(const json& j, T& obj) {
        reflect_json::from_json(j, obj);
    }
};
}
```

* **`has_describe_members<T>`**ï¼štypeâ€traitï¼Œåªæœ‰å¯¹ `T` ä½¿ç”¨è¿‡ `BOOST_DESCRIBE_*` å®æ‰ä¸º `true`ã€‚
* **SFINAE**ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸ ADLâ€serializer ç‰¹åŒ–ä¸Šï¼Œé€šè¿‡ `enable_if` å±è”½æœªæè¿°ç±»å‹ï¼Œé¿å…å¯¹å¦‚ `std::string` ä¹‹ç±»â€œæ— å…ƒä¿¡æ¯â€ç±»å‹è¯¯ç”¨åå°„æ¥å£ã€‚

---

### 4. `src/main.cpp`

```cpp
#include "user.hpp"
#include "describe_util.hpp"
#include "json_reflect.hpp"
#include <nlohmann/json.hpp>
#include <iostream>

int main() {
    User u1{42, "Alice", 75000.0};

    // 1. æ‰“å°æ‰€æœ‰æˆå‘˜
    print_all_members(u1);
    std::cout << "--------\n";

    // 2. åºåˆ—åŒ–ä¸º JSON
    nlohmann::json j = u1;
    std::cout << "Serialized JSON:\n" << j.dump(2) << "\n";
    std::cout << "--------\n";

    // 3. ååºåˆ—åŒ–å›å¯¹è±¡
    User u2 = j.get<User>();
    std::cout << "Deserialized and print again:\n";
    print_all_members(u2);

    return 0;
}
```

* è°ƒç”¨ `print_all_members` éªŒè¯é™æ€åå°„ï¼›
* `nlohmann::json j = u1;` å†…éƒ¨é€šè¿‡ ADLâ€serializer è°ƒç”¨æˆ‘ä»¬çš„ `to_json`ï¼›
* `j.get<User>()` è°ƒç”¨ `from_json`ï¼Œå†æ¬¡æ‰“å°å³å¯çœ‹åˆ°åŸå€¼æ¢å¤ï¼ˆæ³¨æ„ private `salary` å› ä¸ºåªåºåˆ—åŒ– publicï¼Œé‡æ–°æ„é€ åé»˜è®¤ä¸º 0ï¼‰ã€‚

---

## ä¸‰ã€CMake é…ç½®

```cmake
cmake_minimum_required(VERSION 3.14)
project(reflect_example LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

find_package(Boost 1.75 REQUIRED)        # ç³»ç»Ÿ apt å®‰è£…çš„ libboost-all-dev
find_package(nlohmann_json REQUIRED)     # ç³»ç»Ÿ apt å®‰è£…çš„ nlohmann-json3-dev

include_directories(
  ${Boost_INCLUDE_DIRS}
  ${nlohmann_json_INCLUDE_DIRS}
  ${CMAKE_SOURCE_DIR}/include
)

add_executable(reflect_example
  src/main.cpp
)

target_link_libraries(reflect_example
  PRIVATE nlohmann_json::nlohmann_json
)
```

* é€šè¿‡ `sudo apt install libboost-all-dev nlohmann-json3-dev` å®‰è£…ä¾èµ–ï¼Œæ— éœ€ FetchContentã€‚
* `find_package(Boost)` å³å¯è·å¾—æ‰€æœ‰ Boost å¤´æ–‡ä»¶è·¯å¾„ï¼ŒåŒ…å« Describeã€‚

---

## å››ã€æ¶‰åŠçš„å…³é”®çŸ¥è¯†ç‚¹

1. **C++ é™æ€åå°„**

   * æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ï¼Œåœ¨ç¼–è¯‘æœŸé€šè¿‡æ¨¡æ¿/å®æ³¨å…¥å…ƒä¿¡æ¯ï¼›
   * Boost.Describe æä¾› `BOOST_DESCRIBE_CLASS/STRUCT`ï¼Œç”Ÿæˆ `describe_members`ã€`has_describe_members`ã€`describe_bases` ç­‰å·¥å…·ã€‚

2. **Boost.MP11 ç¼–è¯‘æœŸå…ƒç¼–ç¨‹**

   * `mp_for_each` éå†ç±»å‹åˆ—è¡¨ï¼›
   * `describe_members` äº§å‡º Descriptor ç±»å‹åºåˆ—ï¼Œæ¯ä¸ªå« `static constexpr name`ã€`pointer`ã€‚

3. **SFINAE ä¸ ADLâ€Serializer**

   * ç”¨ `std::enable_if_t<has_describe_members<T>>` é™åˆ¶ `to_json`/`from_json` åªåœ¨ `T` è¢«æè¿°åå¯ç”¨ï¼›
   * é€šè¿‡å¯¹ `nlohmann::adl_serializer` çš„éƒ¨åˆ†ç‰¹åŒ–ï¼Œå®ç°æ³›å‹ JSON ç¼–è§£ç æ”¯æŒã€‚

4. **CMake ä¸ç³»ç»ŸåŒ…ç®¡ç†**

   * ä¼˜å…ˆä½¿ç”¨ `apt` æä¾›çš„å¤´â€‘only åº“åŠå…¶ CMake é…ç½®ï¼›
   * ç®€åŒ–é¡¹ç›®é…ç½®ï¼Œé¿å…æ‰‹åŠ¨ç¼–è¯‘æˆ–é¢å¤–é›†æˆã€‚

---

å·¥ç¨‹æ—¢å±•ç¤ºäº†â€œçº¯ C++20 é™æ€åå°„å®æˆ˜â€ï¼Œä¹Ÿç»“åˆäº†ç°ä»£ JSON åºåˆ—åŒ–æŠ€å·§ï¼Œæ‰€æœ‰ä»£ç å‡ä¸º headerâ€‘onlyï¼Œä¸”ä¸ä¾èµ–ç§æœ‰åˆ†å‘ï¼Œåªéœ€ä¸€è¡Œ `apt install` å³å¯å¿«é€Ÿä¸Šæ‰‹ã€‚

ä¸‹é¢æˆ‘å†æŠŠæ•´ä¸ªæµç¨‹å’ŒèƒŒåçš„åŸç†æ‹†å¾—æ›´ç»†ï¼Œåˆ†æ­¥éª¤ã€åˆ†æ¨¡å—åœ°å¸¦ä½ â€œæ‹†è§£â€æ¯ä¸€è¡Œå…³é”®ä»£ç ï¼Œè®©ä½ çœ‹æ‡‚å®ƒä»¬æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚

---

## 1. åœ¨ç±»å‹å†…éƒ¨æ³¨å…¥åå°„å…ƒæ•°æ®ï¼š`BOOST_DESCRIBE_CLASS`

```cpp
struct User {
    int    id;
    std::string name;
private:
    double salary;
public:
    // â€¦ æ„é€ å‡½æ•°ã€get_salary â€¦

    BOOST_DESCRIBE_CLASS(
        User,
        (),                          // ï¼ˆ1ï¼‰åŸºç±»åˆ—è¡¨ï¼Œå½“å‰æ— ç»§æ‰¿
        (id, name, get_salary),      // ï¼ˆ2ï¼‰public æˆå‘˜ï¼šæ•°æ®+å‡½æ•°
        (),                          // ï¼ˆ3ï¼‰protected æˆå‘˜ï¼ˆæ­¤å¤„ç©ºï¼‰
        (salary)                     // ï¼ˆ4ï¼‰private æˆå‘˜
    )
};
```

1. **ä¸ºä»€ä¹ˆè¦åœ¨â€œç±»å†…éƒ¨â€ç”¨å®ï¼Ÿ**

   * å¯¹ç§æœ‰æˆå‘˜åšåå°„æ—¶ï¼Œå¿…é¡»åœ¨ç±»ä½“å†…ï¼Œå› ä¸ºå®å±•å¼€æ—¶éœ€è¦è®¿é—® private åŒºåŸŸã€‚
2. **å®å±•å¼€å¤§è‡´åšäº†ä»€ä¹ˆï¼Ÿ**

   * ä¸º `User` ç”Ÿæˆä¸€ä¸ª `boost::describe::detail::member_descriptor<User>` åˆ—è¡¨ï¼šæ¯ä¸ªå…ƒç´ åŒ…å«æˆå‘˜åï¼ˆ`"id"`ï¼‰å’Œæˆå‘˜æŒ‡é’ˆï¼ˆ`&User::id`ï¼‰ã€‚
   * å®šä¹‰ä¸€ä¸ª `has_describe_members<User>` traitï¼Œä½¿ä¹‹è¿”å› `true`ã€‚
3. **å‚æ•°å«ä¹‰**

   * `()`ï¼šå¦‚æœä½ æœ‰ `struct Derived : Base { â€¦ }`ï¼Œè¿™é‡Œå°±å†™ `(Base)`ï¼Œèƒ½åå°„ç»§æ‰¿å…³ç³»ã€‚
   * `(id, name, get_salary)`ï¼šåˆ—å‡ºæ‰€æœ‰æƒ³å…¬å¼€ç»™åå°„ç³»ç»Ÿçš„ **å…¬æœ‰æˆå‘˜å˜é‡** å’Œ **å…¬æœ‰æˆå‘˜å‡½æ•°**ã€‚
   * `(salary)`ï¼šåˆ—å‡ºç§æœ‰æˆå‘˜ï¼Œä¾¿äºå·¥å…·ï¼ˆå¦‚ JSONï¼‰ä¹Ÿèƒ½è®¿é—®å®ƒçš„å€¼ã€‚

---

## 2. éå†å¹¶æ‰“å°æ‰€æœ‰æˆå‘˜ï¼š`describe_util.hpp`

```cpp
using members = boost::describe::describe_members<
    T,
    boost::describe::mod_public | boost::describe::mod_private
>;
```

* `describe_members<T, mods>`ï¼šåœ¨ç¼–è¯‘æœŸç”Ÿæˆä¸€ä¸ªç±»å‹åˆ—è¡¨ `mp_list<D1, D2, â€¦>`ï¼Œå…¶ä¸­æ¯ä¸ª `Di` ç§°ä¸º **Descriptor**ï¼Œå®šä¹‰ä¸ºï¼š

  ```cpp
  struct Descriptor {
      static constexpr const char* name    = "...";
      static constexpr auto pointer        = &T::...;  // æˆå‘˜æŒ‡é’ˆ
  };
  ```

```cpp
boost::mp11::mp_for_each<members>([&](auto D){
    using Desc = decltype(D);
    print_member(obj, Desc::name, Desc::pointer);
});
```

* **`mp_for_each`**ï¼šæ¥æ”¶ä¸€ä¸ªç¼–è¯‘æœŸç±»å‹åˆ—è¡¨ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å¯¹æ¯ä¸ªç±»å‹éƒ½è°ƒç”¨ä¸€æ¬¡ lambdaã€‚
* **`auto D`**ï¼šè¿™é‡Œçš„ `D` å¹¶ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»å‹åŒ…è£…ï¼ˆåº•å±‚å®ç°ä¼šé€ å‡ºä¸€ä¸ªç©ºçš„ä¸´æ—¶ï¼‰ï¼›
* **`decltype(D)`**ï¼šå–å‡ºçœŸå®çš„ Descriptor ç±»å‹ï¼Œç„¶åè®¿é—®å®ƒçš„ä¸¤ä¸ªé™æ€æˆå‘˜ï¼š

  * `Desc::name`ï¼šæˆå‘˜å
  * `Desc::pointer`ï¼šæˆå‘˜æŒ‡é’ˆ

è¿™æ ·å°±èƒ½åœ¨è¿è¡Œæ—¶æ‰“å°ï¼š

```
  id = 42
  name = Alice
  salary = 75000
```

---

## 3. JSON åºåˆ—åŒ–ï¼š`json_reflect.hpp`

### 3.1 é™åˆ¶åªå¯¹â€œå·²æè¿°â€ç±»å‹å¯ç”¨

```cpp
template<typename T>
std::enable_if_t<boost::describe::has_describe_members<T>::value>
to_json(nlohmann::json& j, const T& obj) { â€¦ }
```

* **`has_describe_members<T>`**ï¼šä¸€ä¸ª `constexpr bool`ï¼Œåªæœ‰å½“å¯¹ `T` ä½¿ç”¨äº† `BOOST_DESCRIBE_*` å®æ—¶æ‰ä¸º `true`ã€‚
* **`std::enable_if_t<â€¦>`**ï¼šåˆ©ç”¨ SFINAEï¼ˆSubstitution Failure Is Not An Errorï¼‰ï¼Œå¦‚æœ `has_describe_members<T>` ä¸º `false`ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥å¿½ç•¥è¿™ä¸ªæ¨¡æ¿ï¼Œä¸äº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚

### 3.2 ADLâ€Serializer ç‰¹åŒ–

```cpp
namespace nlohmann {
template<typename T>
struct adl_serializer<
    T,
    std::enable_if_t<boost::describe::has_describe_members<T>::value, void>
> {
    static void to_json(json& j, const T& obj)   { reflect_json::to_json(j, obj); }
    static void from_json(const json& j, T& obj) { reflect_json::from_json(j, obj); }
};
}
```

* **ADLï¼ˆArgumentâ€Dependent Lookupï¼‰**ï¼šå½“è°ƒç”¨ `nlohmann::json j = u;` æ—¶ï¼Œåº“ä¼šæŸ¥æ‰¾ä¸ `User` åœ¨åŒä¸€å‘½åç©ºé—´çš„ `adl_serializer<User>`ï¼Œå¦‚æœå­˜åœ¨ä¾¿è°ƒç”¨å®ƒã€‚
* è¿™é‡ŒåŒæ ·ç”¨ SFINAEï¼Œ**åªæœ‰** `has_describe_members<User>` ä¸º `true`ï¼Œæ‰æŠŠè¿™ä¸ªç‰¹åŒ–ç‰ˆæœ¬â€œæ¿€æ´»â€ã€‚
* ç»“æœå°±æ˜¯ï¼Œä½ å¯ä»¥å†™ï¼š

  ```cpp
  nlohmann::json j = u;      // è°ƒç”¨æˆ‘ä»¬çš„ to_json
  User u2 = j.get<User>();   // è°ƒç”¨æˆ‘ä»¬çš„ from_json
  ```

---

## 4. CMake + apt å®‰è£…

1. **é€šè¿‡ apt å®‰è£…**

   ```bash
   sudo apt update
   sudo apt install -y libboost-all-dev nlohmann-json3-dev
   ```

   * `libboost-all-dev` åŒ…å« Boost 1.83 åŠå…¶ Describe å¤´æ–‡ä»¶ã€‚
   * `nlohmann-json3-dev` æä¾› `nlohmann/json.hpp` å’Œ CMake çš„ `nlohmann_jsonConfig.cmake`ã€‚

2. **CMakeLists.txt ç²¾ç®€é…ç½®**

   ```cmake
   find_package(Boost 1.75 REQUIRED)        # è·å–æ‰€æœ‰ Boost å¤´
   find_package(nlohmann_json REQUIRED)     # è·å– JSON åº“

   include_directories(${Boost_INCLUDE_DIRS}
                       ${nlohmann_json_INCLUDE_DIRS}
                       ${CMAKE_SOURCE_DIR}/include)

   add_executable(reflect_example src/main.cpp)
   target_link_libraries(reflect_example PRIVATE nlohmann_json::nlohmann_json)
   ```

* ä¸éœ€è¦æ‰‹åŠ¨æ‹‰å–ä»»ä½•ç¬¬ä¸‰æ–¹å¤´â€‘only åº“ï¼Œä¸€è¡Œ apt å°±å…¨éƒ¨æå®šã€‚
* CMake è‡ªåŠ¨å¸®ä½ æŠŠå¤´æ–‡ä»¶ç›®å½•å’Œåº“è·¯å¾„éƒ½é…ç½®å¥½ã€‚

---

## 5. ä»é›¶å¼€å§‹ï¼Œ ä»”ç»†â€œçœ‹â€ä¸€æ¬¡è¿è¡Œæµ

1. **ç¼–è¯‘æœŸ**

   * `BOOST_DESCRIBE_CLASS` å®åœ¨é¢„å¤„ç†å±•å¼€ï¼Œç”Ÿæˆ `Descriptor` ç±»å‹åˆ—è¡¨å’Œ `has_describe_members` traitã€‚
   * `describe_members<T, â€¦>` è§£æå‡º `Descriptorâ€¦` åºåˆ—ã€‚
   * ADLâ€serializer ç‰¹åŒ–ä»…åœ¨ `T` è¢«æè¿°åæ‰å€™é€‰ã€‚

2. **è¿è¡Œæ—¶**

   * `print_all_members(u1)`ï¼šéå†æ‰€æœ‰Descriptorï¼Œè°ƒç”¨ `print_member`ï¼Œæ‰“å°æˆå‘˜ã€‚
   * `nlohmann::json j = u1;`ï¼šè§¦å‘ ADLâ€lookupï¼Œæ‰¾åˆ°æˆ‘ä»¬çš„ `to_json`ï¼Œä¾æ¬¡æŠŠæ¯ä¸ª `obj.*pointer` å¡è¿› `j[name]`ã€‚
   * `j.get<User>()`ï¼šåŒç†è§¦å‘ `from_json`ï¼ŒæŠŠ JSON ä¸­çš„å­—æ®µå€¼èµ‹å› `obj.*pointer`ã€‚

---

### å¿ƒå¾—

* **é™æ€åå°„**ï¼šå…¨åœ¨ç¼–è¯‘æœŸâ€œç»‡â€å¥½å…ƒä¿¡æ¯ï¼Œè¿è¡Œæ—¶æ‹“å±•èƒ½åŠ›å¼ºä¸”æ²¡æœ‰é¢å¤–å¼€é”€ã€‚
* **Boost.Describe**ï¼šæœ€å°ä¾µå…¥ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰æˆå‘˜å£°æ˜ï¼Œåªè¦åœ¨ç±»ä½“\*\*å¤–ï¼ˆSTRUCTï¼‰æˆ–å†…ï¼ˆCLASSï¼‰\*\*æ‰“ä¸€è¡Œå®ã€‚
* **Boost.MP11**ï¼šç°ä»£ C++ å…ƒç¼–ç¨‹åº“ï¼Œç”¨ç®€æ´çš„ `mp_for_each` ä»£æ›¿ä¼ ç»Ÿçš„æ¨¡æ¿é€’å½’ã€‚
* **SFINAE + ADL**ï¼šè®© JSON åºåˆ—åŒ–â€œåªå¯¹æƒ³è¦çš„ç±»å‹â€ç”Ÿæ•ˆï¼Œä¸å¹²æ‰°æ ‡å‡†ç±»å‹ã€‚

éå¸¸å¥½çš„é—®é¢˜ï¼ç®€è¦å›ç­”å¦‚ä¸‹ï¼š

---

## âœ… Boost.Describe **ä¸æ˜¯å¿…é¡»ä¾èµ– Boost å…¨é‡åº“**ï¼Œå¯ä»¥**å•ç‹¬ä½¿ç”¨**

### å®ƒçš„ä¾èµ–éå¸¸è½»ï¼Œåªéœ€è¦ï¼š

* Boost.Configï¼ˆé…ç½®å®ï¼‰
* Boost.MP11ï¼ˆå…ƒç¼–ç¨‹ï¼Œç¼–è¯‘æœŸ for-each ç­‰ï¼‰
* Boost.Coreï¼ˆå°‘é‡ç±»å‹å·¥å…·ï¼‰
* C++17ï¼ˆæˆ– C++14+éƒ¨åˆ†æŠ€å·§ï¼‰

---

## ğŸ“¦ ä½¿ç”¨æ–¹å¼ä¸€ï¼šä» Boost å®˜æ–¹ Release ä¸­**å•ç‹¬æå–** Describe æ‰€éœ€æ–‡ä»¶

ä½ å¯ä»¥åªå¤åˆ¶ `boost/describe` å’Œ `boost/mp11` ç›®å½•ï¼Œä¸éœ€è¦å®Œæ•´ Boost å®‰è£…ã€‚ç›®å½•å…³ç³»å¤§è‡´å¦‚ä¸‹ï¼š

```
your_project/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ boost/
â”‚       â”œâ”€â”€ describe/
â”‚       â”‚   â”œâ”€â”€ describe_class.hpp
â”‚       â”‚   â”œâ”€â”€ describe_members.hpp
â”‚       â”‚   â”œâ”€â”€ ...
â”‚       â””â”€â”€ mp11/
â”‚           â”œâ”€â”€ algorithm.hpp
â”‚           â””â”€â”€ ...
```

åªè¦ä¿è¯ä»¥ä¸‹å¤´æ–‡ä»¶èƒ½æ­£å¸¸æ‰¾åˆ°ï¼ŒDescribe å°±èƒ½ç”¨ï¼š

```cpp
#include <boost/describe.hpp>   // å¼•å…¥ describe_class + describe_members
#include <boost/mp11.hpp>       // æä¾› mp_list, mp_for_each ç­‰åŠŸèƒ½
```

åœ¨ Boost GitHub ä¸Šï¼Œè¿™äº›å¤´æ–‡ä»¶éƒ½å¯ä»¥**ç›´æ¥å¤åˆ¶ä½¿ç”¨**ï¼š

* Boost.Describe: [https://github.com/boostorg/describe](https://github.com/boostorg/describe)
* Boost.MP11: [https://github.com/boostorg/mp11](https://github.com/boostorg/mp11)

---

## ğŸ“¦ ä½¿ç”¨æ–¹å¼äºŒï¼šCMake ä¸­**æŒ‰ç»„ä»¶å¼•å…¥ Boost**

å¦‚æœä½ ä¸æƒ³å¤åˆ¶ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨ `find_package(Boost COMPONENTS describe REQUIRED)` æ–¹å¼å¼•å…¥ï¼ˆ**å‰ææ˜¯ Boost æ”¯æŒç»„ä»¶åŒ–æ„å»º**ï¼Œå¦‚é€šè¿‡ vcpkg æˆ– CMake æ„å»º Boostï¼‰ï¼Œä¾‹å¦‚ï¼š

```cmake
find_package(Boost 1.75 REQUIRED COMPONENTS describe mp11)
target_link_libraries(your_target Boost::describe Boost::mp11)
```

ä¸è¿‡ï¼Œ**APT å®‰è£…çš„ libboost-all-dev é€šå¸¸ä¸æä¾› CMake ç»„ä»¶åŒ…æè¿°**ï¼ˆè¿™æ˜¯ä½ æœ€åˆé‡åˆ° `boost_describe-config.cmake` ç¼ºå¤±çš„æ ¹æœ¬åŸå› ï¼‰ã€‚

---

## ğŸ“Œ æ€»ç»“ï¼šæ˜¯å¦éœ€è¦å…¨é‡ Boostï¼Ÿ

| ä½¿ç”¨æ–¹å¼                | éœ€è¦å…¨é‡ Boost å—ï¼Ÿ | æ¨èç¨‹åº¦          |
| ------------------- | ------------- | ------------- |
| ç³»ç»ŸåŒ…ï¼ˆaptï¼‰å®‰è£…          | âœ… æ˜¯           | âœ… å¿«æ·æ–¹ä¾¿ï¼ˆåˆå­¦è€…é€‚åˆï¼‰ |
| åªå¤åˆ¶ describe + mp11 | âŒ ä¸éœ€è¦         | âœ… æ¨èç”¨äºè½»é‡é¡¹ç›®    |
| vcpkg + CMake       | âŒ å¯ç»„ä»¶å¼        | âœ… å¯æ§æ€§æ›´é«˜ï¼Œæ¨èè¿›é˜¶è€… |

---

## ğŸ’¡ å»ºè®®æ–¹æ¡ˆ

* å¦‚æœä½ è¿½æ±‚ **æœ€å°ä¾èµ– + å¿«é€Ÿä½¿ç”¨** â†’ ç›´æ¥ä» Boost GitHub å¤åˆ¶ `boost/describe` å’Œ `boost/mp11` ç›®å½•ï¼›
* å¦‚æœä½ ç”¨ `vcpkg` ç®¡ç†ä¾èµ–ï¼Œå¯ä»¥åªå¯ç”¨ Boost.Describe ä¸ Boost.MP11ï¼›
* å¦‚æœä½ å·²ç»é€šè¿‡ `apt install libboost-all-dev` å®‰è£…äº† Boostï¼Œå…¨é‡ä½¿ç”¨ä¹Ÿæ²¡é—®é¢˜ï¼Œåªæ˜¯ç¨æ˜¾é‡ã€‚

---

å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ª **æç®€ã€æ—  Boost å®‰è£…ä¾èµ–ã€åªåŒ…å« Describe å’Œ MP11 çš„ C++ åå°„å·¥ç¨‹**ã€‚ä½ åªéœ€å¤åˆ¶ä»¥ä¸‹ç»“æ„ä¸ä»£ç ï¼Œå³å¯ç›´æ¥ `g++ main.cpp -std=c++17` ç¼–è¯‘è¿è¡Œï¼Œæ— éœ€ Boost å®‰è£…ã€‚

---

## âœ… ç›®å½•ç»“æ„

```
reflect_minimal/
â”œâ”€â”€ main.cpp
â””â”€â”€ boost/
    â”œâ”€â”€ describe/
    â”‚   â”œâ”€â”€ describe_class.hpp
    â”‚   â”œâ”€â”€ describe_enum.hpp
    â”‚   â”œâ”€â”€ describe_members.hpp
    â”‚   â”œâ”€â”€ ...
    â””â”€â”€ mp11/
        â”œâ”€â”€ algorithm.hpp
        â”œâ”€â”€ list.hpp
        â”œâ”€â”€ utility.hpp
        â””â”€â”€ ...
```

> ğŸ“¦ æ‰€æœ‰æ–‡ä»¶å¯ç›´æ¥ä» Boost GitHub ä¸‹è½½ï¼š
>
> * [boostorg/describe](https://github.com/boostorg/describe/tree/develop/include/boost/describe)
> * [boostorg/mp11](https://github.com/boostorg/mp11/tree/develop/include/boost/mp11)

**åªéœ€å¤åˆ¶ `boost/describe/` å’Œ `boost/mp11/` ä¸¤ä¸ªå­ç›®å½•åˆ°æœ¬åœ°å³å¯ã€‚**

---

## âœ… ç¤ºä¾‹ä»£ç  `main.cpp`

```cpp
#include <iostream>
#include <string>
#include "boost/describe/describe_class.hpp"
#include "boost/describe/describe_members.hpp"
#include "boost/mp11.hpp"

struct User {
    int id;
    std::string name;
private:
    double salary;
public:
    User(int i, std::string n, double s) : id(i), name(std::move(n)), salary(s) {}

    double get_salary() const { return salary; }

    BOOST_DESCRIBE_CLASS(User, (), (id, name, get_salary), (), (salary))
};

template<typename T>
void print_members(const T& obj) {
    using members = boost::describe::describe_members<
        T,
        boost::describe::mod_public | boost::describe::mod_private
    >;

    boost::mp11::mp_for_each<members>([&](auto D) {
        using Desc = decltype(D);
        std::cout << Desc::name << " = " << obj.*(Desc::pointer) << "\n";
    });
}

int main() {
    User u{101, "Alice", 5000.0};
    print_members(u);
    return 0;
}
```

---

## âœ… ç¼–è¯‘å‘½ä»¤ï¼ˆä»…éœ€ C++17 æ”¯æŒï¼‰

```bash
g++ -std=c++17 main.cpp -I. -o reflect_minimal
./reflect_minimal
```

ä½ å°†çœ‹åˆ°è¾“å‡ºï¼š

```
id = 101
name = Alice
salary = 5000
```

---

## âœ… æ€»ç»“

| é¡¹ç›®ç‰¹ç‚¹                  | æè¿°                            |
| --------------------- | ----------------------------- |
| âŒ ä¸ä¾èµ–ç³»ç»Ÿ Boost         | ä¸éœ€è¦ `apt install`             |
| âœ… åªå¤åˆ¶ describe å’Œ mp11 | ä¸¤ä¸ªç›®å½•å‡ å KB å³å¯                  |
| âœ… å¯ç›´æ¥ç”¨ g++/clang++ ç¼–è¯‘ | æ— éœ€ CMake                      |
| âœ… æ”¯æŒé™æ€åå°„æˆå‘˜åå’ŒæŒ‡é’ˆ        | å¯éå†è®¿é—®ç±»æˆå‘˜                      |
| âœ… æ”¯æŒç§æœ‰æˆå‘˜åå°„            | ä»…é™ç±»å†…ä½¿ç”¨ BOOST\_DESCRIBE\_CLASS |

---


å¾ˆå¥½çš„é—®é¢˜ï¼

---

## âœ… ç®€æ´å›ç­”ï¼š

**JSON åºåˆ—åŒ–**çš„ä½œç”¨æ˜¯ï¼š

> **æŠŠ C++ å¯¹è±¡è½¬æˆå­—ç¬¦ä¸²æ ¼å¼ï¼ˆJSON æ–‡æœ¬ï¼‰ï¼Œæ–¹ä¾¿ç½‘ç»œä¼ è¾“ã€æŒä¹…åŒ–å­˜å‚¨ã€è°ƒè¯•å¯è§†åŒ–ç­‰ã€‚**

### åè¿‡æ¥ï¼Œ**JSON ååºåˆ—åŒ–**å°±æ˜¯ï¼š

> **ä» JSON å­—ç¬¦ä¸²è¿˜åŸå‡º C++ å¯¹è±¡ï¼Œä¾¿äºç¨‹åºè¯»å–ç»“æ„åŒ–æ•°æ®ã€‚**

---

## ğŸ” ä¸¾ä¸ªå®é™…ä¾‹å­

ä½ æœ‰ä¸ª C++ ç»“æ„ä½“ï¼š

```cpp
struct User {
    int id;
    std::string name;
    double salary;
};
User u{101, "Alice", 5000.0};
```

ä½ å¸Œæœ›ï¼š

1. **ä¿å­˜åˆ°æ–‡ä»¶ä¸­**ï¼›
2. **é€šè¿‡ç½‘ç»œå‘é€ç»™åç«¯æœåŠ¡**ï¼›
3. **è°ƒè¯•æ—¶è¾“å‡ºç”¨æˆ·å†…å®¹ç»“æ„**ï¼›
4. **è®©å‰ç«¯æˆ– Python è„šæœ¬ä¹Ÿèƒ½è¯»å–è¿™ä¸ªç»“æ„**ã€‚

å¦‚æœä½ ä¸åºåˆ—åŒ–ï¼Œ`User` æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å†…å­˜å—ï¼Œæ²¡äººèƒ½çœ‹æ‡‚ã€‚

ä½†å¦‚æœä½ åšäº† **JSON åºåˆ—åŒ–**ï¼š

```json
{
  "id": 101,
  "name": "Alice",
  "salary": 5000.0
}
```

è¿™ä¸ªæ ¼å¼ï¼š

* âœ… äººèƒ½è¯»ï¼›
* âœ… ç¨‹åºè¯­è¨€é€šç”¨ï¼ˆPython/JS/Rust/C++ éƒ½å¯è§£æï¼‰ï¼›
* âœ… å­˜å‚¨åˆ°ç£ç›˜ä¹Ÿä¸æ€•ç‰ˆæœ¬å˜åŒ–ï¼ˆå­—æ®µåå­—æ¸…æ™°ï¼‰ã€‚

---

## ğŸ§  ä¸ºä»€ä¹ˆè¦å’Œâ€œé™æ€åå°„â€ç»“åˆï¼Ÿ

åœ¨ C++ ä¸­ä½ æ²¡åŠæ³•â€œè‡ªåŠ¨â€çŸ¥é“ä¸€ä¸ªç»“æ„é‡Œæœ‰ `id` / `name` / `salary` è¿™å‡ ä¸ªå­—æ®µã€‚ä½ è¦ä¹ˆï¼š

1. å†™å¤§é‡æ‰‹åŠ¨ä»£ç ï¼š

   ```cpp
   j["id"] = u.id;
   j["name"] = u.name;
   j["salary"] = u.salary;
   ```

2. ä½¿ç”¨ Boost.Describe æä¾›çš„â€œç»“æ„è‡ªçœâ€ï¼ˆåå°„ï¼‰ï¼š

   * è‡ªåŠ¨çŸ¥é“ç»“æ„ä½“æœ‰å“ªäº›å­—æ®µï¼›
   * è‡ªåŠ¨æå–è¿™äº›å­—æ®µåå’Œå€¼ï¼›
   * è‡ªåŠ¨æ‹¼æˆ JSONï¼›
   * å°†æ¥ç»“æ„å˜äº†ï¼Œåªæ”¹ä¸€ä¸ªå®å³å¯ï¼Œä¸å†ç»´æŠ¤å¤§æ®µæ¨¡æ¿ä»£ç ã€‚

è¿™æ ·ä½ å¯ä»¥åšåˆ°ï¼š

```cpp
nlohmann::json j = u;    // è‡ªåŠ¨åºåˆ—åŒ–
User u2 = j.get<User>(); // è‡ªåŠ¨ååºåˆ—åŒ–
```

è¿™å°±æ˜¯ç»“åˆ Boost.Describe + nlohmann/json çš„å¨åŠ›ã€‚

---

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> **JSON åºåˆ—åŒ– = æŠŠ C++ å¯¹è±¡å˜æˆé€šç”¨çš„ã€è·¨è¯­è¨€çš„ã€ç»“æ„åŒ–å­—ç¬¦ä¸²æ ¼å¼ï¼›ç»“åˆåå°„ = çœå»æ‰‹åŠ¨ç»´æŠ¤å­—æ®µå¯¹åº”é€»è¾‘ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œå¯æ‰©å±•æ€§ã€‚**

---

å¥½çš„ï¼æˆ‘ä»¬åœ¨ä½ å½“å‰çš„ **æç®€é™æ€åå°„é¡¹ç›®** ä¸Šï¼Œæ·»åŠ å®Œæ•´çš„ **JSON è‡ªåŠ¨åºåˆ—åŒ– / ååºåˆ—åŒ–** æ”¯æŒï¼Œä¾æ—§åšåˆ°ï¼š

* âœ… æ— éœ€å®‰è£… Boost å…¨åº“ï¼›
* âœ… æ— éœ€é¢å¤–æ„å»ºç³»ç»Ÿï¼›
* âœ… `g++` ä¸€æ¡å‘½ä»¤å³å¯è¿è¡Œï¼›
* âœ… æ”¯æŒç§æœ‰æˆå‘˜ï¼›
* âœ… å¯æ‰©å±•æ€§å¼ºã€‚

---

## âœ… æœ€ç»ˆç›®æ ‡

è®©ä½ å†™ï¼š

```cpp
nlohmann::json j = user;    // è‡ªåŠ¨åºåˆ—åŒ–
User u2 = j.get<User>();    // è‡ªåŠ¨ååºåˆ—åŒ–
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„ï¼ˆæ–°å¢ json åº“ï¼‰

```
reflect_json/
â”œâ”€â”€ main.cpp
â”œâ”€â”€ json.hpp                    â† å¼•å…¥ nlohmann::json å•å¤´æ–‡ä»¶
â”œâ”€â”€ json_reflect.hpp           â† è‡ªåŠ¨ JSON åå°„ä»£ç 
â””â”€â”€ boost/
    â”œâ”€â”€ describe/
    â””â”€â”€ mp11/
```

ä½ åªéœ€æ‰‹åŠ¨æ·»åŠ  2 ä¸ªæ–‡ä»¶ï¼š

* `json.hpp`: ä» [https://github.com/nlohmann/json/releases](https://github.com/nlohmann/json/releases) ä¸‹è½½æœ€æ–°å•å¤´ç‰ˆï¼ˆå¦‚ `json.hpp`ï¼‰
* `json_reflect.hpp`: æˆ‘å†™å¥½çš„è‡ªåŠ¨åºåˆ—åŒ–æ¡¥æ¥ä»£ç ï¼ˆè§ä¸‹ï¼‰

---

## ğŸ”§ json\_reflect.hpp

```cpp
#pragma once
#include <boost/describe.hpp>
#include <boost/mp11.hpp>
#include <nlohmann/json.hpp>

namespace reflect_json {

template<typename T>
void to_json(nlohmann::json& j, const T& obj) {
    using members = boost::describe::describe_members<
        T, boost::describe::mod_public | boost::describe::mod_private>;
    boost::mp11::mp_for_each<members>([&](auto D) {
        using Desc = decltype(D);
        j[Desc::name] = obj.*(Desc::pointer);
    });
}

template<typename T>
void from_json(const nlohmann::json& j, T& obj) {
    using members = boost::describe::describe_members<
        T, boost::describe::mod_public | boost::describe::mod_private>;
    boost::mp11::mp_for_each<members>([&](auto D) {
        using Desc = decltype(D);
        j.at(Desc::name).get_to(obj.*(Desc::pointer));
    });
}

} // namespace reflect_json

// ğŸ‘‡ è‡ªåŠ¨æ³¨å†Œç»™ nlohmann::json
namespace nlohmann {
template<typename T>
struct adl_serializer<
    T,
    std::enable_if_t<boost::describe::has_describe_members<T>::value, void>> {
    static void to_json(json& j, const T& obj) {
        reflect_json::to_json(j, obj);
    }
    static void from_json(const json& j, T& obj) {
        reflect_json::from_json(j, obj);
    }
};
}
```

---

## ğŸ”§ main.cpp ç¤ºä¾‹

```cpp
#include <iostream>
#include <string>
#include "boost/describe/describe_class.hpp"
#include "boost/describe/describe_members.hpp"
#include "boost/mp11.hpp"
#include "json.hpp"
#include "json_reflect.hpp"

struct User {
    int id;
    std::string name;
private:
    double salary;
public:
    User(int i, std::string n, double s) : id(i), name(std::move(n)), salary(s) {}
    double get_salary() const { return salary; }

    BOOST_DESCRIBE_CLASS(User, (), (id, name, get_salary), (), (salary))
};

int main() {
    User u1{101, "Alice", 7500.0};

    // è‡ªåŠ¨åºåˆ—åŒ–
    nlohmann::json j = u1;
    std::cout << j.dump(4) << "\n";

    // è‡ªåŠ¨ååºåˆ—åŒ–
    User u2 = j.get<User>();
    nlohmann::json j2 = u2;
    std::cout << j2.dump(4) << "\n";
}
```

---

## âœ… ç¼–è¯‘å‘½ä»¤ï¼ˆä¸éœ€è¦ CMakeï¼‰

```bash
g++ -std=c++17 -I. main.cpp -o reflect_json
./reflect_json
```

è¾“å‡ºç¤ºä¾‹ï¼š

```json
{
    "id": 101,
    "name": "Alice",
    "salary": 7500.0
}
{
    "id": 101,
    "name": "Alice",
    "salary": 7500.0
}
```

---

## âœ… å®Œå…¨ä¸ä¾èµ–ç³»ç»Ÿåº“

æ‰€æœ‰ä¾èµ–æ–‡ä»¶éƒ½æ˜¯ä½ è‡ªå·±æœ¬åœ°æŒæœ‰çš„ï¼Œä¸éœ€è¦ï¼š

* ä¸éœ€è¦ `apt install`
* ä¸éœ€è¦ `find_package`
* ä¸éœ€è¦é“¾æ¥ boost ç³»ç»Ÿåº“
* ä¸éœ€è¦ CMake

---

## ğŸš€ åç»­æ‰©å±•

ä½ ç°åœ¨å¯ä»¥éå¸¸è½»æ¾åœ°ä¸ºä»»ä½•ç»“æ„ä½“æ·»åŠ  JSON æ”¯æŒï¼Œåªéœ€ï¼š

```cpp
BOOST_DESCRIBE_CLASS(MyType, (), (field1, field2), (), ())
```

ç„¶åå°±èƒ½ç›´æ¥ï¼š

```cpp
nlohmann::json j = obj;
MyType copy = j.get<MyType>();
```

---


